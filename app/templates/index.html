{% extends "base.html" %}

{% block content %}
<div class="task-container">
    <section class="add-task-section">
        <h2>Add New Task</h2>
        <form method="POST" action="{{ url_for('main.add_task') }}" class="task-form">
            <div class="form-group">
                <input 
                    type="text" 
                    name="content" 
                    placeholder="What needs to be done?" 
                    required 
                    maxlength="500"
                    class="task-input"
                >
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <select name="category" class="task-select" required>
                        <option value="">Select Category</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <input 
                        type="datetime-local" 
                        name="deadline" 
                        class="task-input"
                        placeholder="Deadline (optional)"
                    >
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">
                <span>+ Add Task</span>
            </button>
        </form>
    </section>

    <section class="filter-section">
        <form method="GET" class="filter-form">
            <input 
                type="text" 
                name="search" 
                placeholder="Search tasks..." 
                value="{{ request.args.get('search', '') }}"
                class="search-input"
            >
            
            <select name="category" class="filter-select">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>
                    {{ cat }}
                </option>
                {% endfor %}
            </select>
            
            <select name="completed" class="filter-select">
                <option value="all" {% if request.args.get('completed', 'all') == 'all' %}selected{% endif %}>
                    All Tasks
                </option>
                <option value="active" {% if request.args.get('completed') == 'active' %}selected{% endif %}>
                    Active
                </option>
                <option value="completed" {% if request.args.get('completed') == 'completed' %}selected{% endif %}>
                    Completed
                </option>
            </select>
            
            <select name="sort" class="filter-select">
                <option value="date_created" {% if request.args.get('sort', 'date_created') == 'date_created' %}selected{% endif %}>
                    Sort by Date
                </option>
                <option value="deadline" {% if request.args.get('sort') == 'deadline' %}selected{% endif %}>
                    Sort by Deadline
                </option>
                <option value="category" {% if request.args.get('sort') == 'category' %}selected{% endif %}>
                    Sort by Category
                </option>
                <option value="completed" {% if request.args.get('sort') == 'completed' %}selected{% endif %}>
                    Sort by Status
                </option>
            </select>
            
            <button type="submit" class="btn btn-secondary">Filter</button>
            <a href="{{ url_for('main.index') }}" class="btn btn-secondary">Reset</a>
        </form>
    </section>

    <section class="tasks-section">
        <h2>Your Tasks ({{ tasks|length }})</h2>
        
        {% if tasks|length < 1 %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>No tasks found</h3>
            <p>Add a task above to get started!</p>
        </div>
        {% else %}
        <div class="tasks-grid">
            {% for task in tasks %}
            <div class="task-card {% if task.completed %}completed{% endif %} {% if task.is_overdue() %}overdue{% endif %}" data-task-id="{{ task.id }}">
                <div class="task-header">
                    <div class="task-checkbox-wrapper">
                        <input 
                            type="checkbox" 
                            class="task-checkbox" 
                            {% if task.completed %}checked{% endif %}
                            onchange="window.location.href='{{ url_for('main.toggle_complete', task_id=task.id) }}'"
                        >
                    </div>
                    <span class="task-category category-{{ task.category.lower() }}">
                        {{ task.category }}
                    </span>
                </div>
                
                <div class="task-body">
                    <p class="task-content">{{ task.content }}</p>
                </div>
                
                <div class="task-footer">
                    <div class="task-meta">
                        <span class="task-date">
                            ğŸ“… {{ task.date_created.strftime('%b %d, %Y') }}
                        </span>
                        {% if task.deadline %}
                        <span class="task-deadline {% if task.is_overdue() %}overdue-text{% endif %}">
                            â° {{ task.deadline.strftime('%b %d, %Y %H:%M') }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="task-actions">
                        <a href="{{ url_for('main.update_task', task_id=task.id) }}" class="btn-icon" title="Edit">
                            âœï¸
                        </a>
                        <a 
                            href="{{ url_for('main.delete_task', task_id=task.id) }}" 
                            class="btn-icon delete-btn" 
                            title="Delete"
                            onclick="return confirm('Are you sure you want to delete this task?')"
                        >
                            ğŸ—‘ï¸
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}
